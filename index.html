<!DOCTYPE html>
<html lang="en">
  <meta charset="UTF-8">
  <title>Breakout</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
  canvas {
    border: 1px solid black;
  }
  </style>

  <body>
    <canvas id="rt" width="640" height="480"></canvas>
    <script>
    ;(() => {
      let previousFrame = new Date();

      const ball_radius = 5;
      let ball_x = 320;
      let ball_y = 380;

      // brick size,
      const brick_width = 30;
      const brick_height = 10;

      // player size,
      const player_width = 30;
      const player_height = 10;

      // Position for the upper left corner of player
      let player_x = 320 - player_width / 2;
      let player_y = 420;

      // User input,
      let up = false;
      let down = false;
      let right = false;
      let left = false;

      function keyDownHandler(event) {
        if (event.keyCode === 39) {
          right = true;
        } else if (event.keyCode === 37) {
          left = true;
        }

        if (event.keyCode === 40) {
          down = true;
        } else if (event.keyCode === 38) {
          up = true;
        }
      }

      function keyUpHandler(event) {
        if (event.keyCode === 39) {
          right = false;
        } else if (event.keyCode === 37) {
          left = false;
        }

        if (event.keyCode === 40) {
          down = false;
        } else if (event.keyCode === 38) {
          up = false;
        }
      }

      document.addEventListener("keydown", keyDownHandler, false);
      document.addEventListener("keyup", keyUpHandler, false);

      function main() {
        window.requestAnimationFrame(main);

        let currentFrame = new Date();

        // update the x,y positions,
        if (up) {
          player_y -= 1;
        } else if (down) {
          player_y += 1;
        }

        if (left) {
          player_x -= 1;
        } else if (right) {
          player_x += 1;
        }

        const canvas = document.getElementById("rt");
        if (canvas.getContext) {
          const ctx = canvas.getContext("2d");

          // clear the canvas
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          let fps = 1000 / (currentFrame - previousFrame);
          ctx.fillText(`fps: ${fps.toFixed(2)}`, 5, 20);
          previousFrame = currentFrame;

          for (i = 0; i < 8; i++) {
            for (j = 0; j < 20; j++) {
              let red = j * Math.floor(255 / 20);
              let green = i * Math.floor(255 / 8);
              ctx.fillStyle = `rgb(${red} ${green} 100)`;
              ctx.fillRect(j*(brick_width+2) + 1, i*(brick_height+2) + 60, brick_width, brick_height);
            }
          }

          // draw the ball
          ctx.beginPath();
          ctx.fillStyle = "rgb(0 0 0)";
          ctx.arc(ball_x, ball_y, ball_radius, 0, Math.PI*2);
          ctx.fill();

          // draw the player
          ctx.fillStyle = "rgb(200 0 0)";
          ctx.fillRect(player_x, player_y, player_width, player_height);
        }

      }

      main();
    })();
    </script>
  </body>
</html>
