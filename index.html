<!DOCTYPE html>
<html lang="en">
  <meta charset="UTF-8">
  <title>Breakout</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <style>
  canvas {
    border: 1px solid black;
  }
  </style>

  <body>
    <canvas id="rt" width="640" height="480"></canvas>
    <script>
    ;(() => {
      let previousFrame = new Date();

      const ballRadius = 5;
      const ballSpeed = 2;
      let ballX = 320;
      let ballY = 380;
      let ballDirectionX = 1.0;
      let ballDirectionY = 1.0;

      // brick size,
      const brickWidth = 30;
      const brickHeight = 10;

      // player size,
      const playerWidth = 30;
      const playerHeight = 10;

      // Position for the upper left corner of player
      let playerX = 320 - playerWidth / 2;
      let playerY = 420;

      // User input,
      let right = false;
      let left = false;

      function keyDownHandler(event) {
        if (event.keyCode === 39) {
          right = true;
        } else if (event.keyCode === 37) {
          left = true;
        }
      }

      function keyUpHandler(event) {
        if (event.keyCode === 39) {
          right = false;
        } else if (event.keyCode === 37) {
          left = false;
        }
      }

      document.addEventListener("keydown", keyDownHandler, false);
      document.addEventListener("keyup", keyUpHandler, false);

      function main() {
        window.requestAnimationFrame(main);

        let currentFrame = new Date();

        if (left) {
          playerX -= 3;
        } else if (right) {
          playerX += 3;
        }

        // update ball position,
        ballX += ballDirectionX;
        ballY += ballDirectionY;

        // collision checks
        if (ballY + ballRadius >= 480 || ballY - ballRadius <= 0) {
          ballDirectionY *= -1;
        }

        if (ballX + ballRadius >= 640 || ballX - ballRadius <= 0) {
          ballDirectionX *= -1;
        }

        const canvas = document.getElementById("rt");
        if (canvas.getContext) {
          const ctx = canvas.getContext("2d");

          // clear the canvas
          ctx.clearRect(0, 0, canvas.width, canvas.height);

          let fps = 1000 / (currentFrame - previousFrame);
          ctx.fillText(`fps: ${fps.toFixed(2)}`, 5, 20);
          previousFrame = currentFrame;

          for (i = 0; i < 8; i++) {
            for (j = 0; j < 20; j++) {
              let red = j * Math.floor(255 / 20);
              let green = i * Math.floor(255 / 8);
              ctx.fillStyle = `rgb(${red} ${green} 100)`;
              ctx.fillRect(j*(brickWidth+2) + 1, i*(brickHeight+2) + 60, brickWidth, brickHeight);
            }
          }

          // draw the ball
          ctx.beginPath();
          ctx.fillStyle = "rgb(0 0 0)";
          ctx.arc(ballX, ballY, ballRadius, 0, Math.PI*2);
          ctx.fill();

          // draw the player
          ctx.fillStyle = "rgb(200 0 0)";
          ctx.fillRect(playerX, playerY, playerWidth, playerHeight);
        }

      }

      main();
    })();
    </script>
  </body>
</html>
